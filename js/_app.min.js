function state_set(a,b){"use strict";try{console.log("setting:",a,b),localStorage.setItem(a,b)}catch(c){}}function state_get(a){"use strict";try{return console.log("getting:",a),localStorage.getItem(a)}catch(b){return!1}}function state_remove(a){"use strict";try{return console.log("removing:",a),localStorage.removeItem(a),!0}catch(b){return!1}}function test_get(){"use strict";var a="modernizr";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}}var timestamp=(new Date).getTime();$(function(){"use strict";var a,b,c,d=$("#searchbox");$("#search").click(function(){d.toggle()}),a=Backbone.Model.extend({el_current:$("#current_projects"),el_past:$("#past_projects"),initialize:function(){_.bindAll(this,"loadJSON","loadSearch","loadTemplate","process","render")},foundation_loaded:!1,data:[],rendered:[],filter_events_ready:!1,num_projects:0,search:[],project_filter_count:0,init:function(){this.loadJSON(),this.loadTemplate(),this.loadSearch()},loadSearch:function(){var a=this;$.getJSON("./json/search.json",function(b){a.search.items=b&&b.length?b:[],a.trigger("loaded:search")}),$.get("./views/search_snippet.html",function(b){a.search.tpl=b,a.trigger("loaded:search")})},loadJSON:function(){var a=this;$.getJSON("./json/projects.min.json?"+timestamp,function(b){void 0!==b.projects&&(a.num_projects=0,void 0!==b.projects.current&&b.projects.current.length&&(b.projects.current=_.map(b.projects.current,function(a){return a.project_type="current",a}),Array.prototype.push.apply(a.data,b.projects.current),a.num_projects+=b.projects.current.length),void 0!==b.projects.past&&b.projects.past.length&&(b.projects.past=_.map(b.projects.past,function(a){return a.project_type="past",a}),Array.prototype.push.apply(a.data,b.projects.past),a.num_projects+=b.projects.past.length)),void 0!==b.intro_text&&b.intro_text&&$("#intro_text").html(b.intro_text),void 0!==b.about&&b.about&&$("#intro .about").html(b.about),a.trigger("loaded:json")})},loadTemplate:function(){var a=this;$.get("./views/template.html?"+timestamp,function(b){a.template=b,a.trigger("loaded:template")})},process:function(){if(this.template&&this.data){var a,b=[],c={},d="";for(b.current=b.past="",this.project_filter_count=0,a=0;a<this.num_projects;a+=1)void 0===this.data[a].visibility&&(this.data[a].visibility=1),1===this.data[a].visibility&&(this.project_filter_count=this.project_filter_count+1,this.data[a].hasTechnology=void 0!==this.data[a].technology&&this.data[a].technology?!0:!1,this.data[a].hasImg=void 0!==this.data[a].imgs&&this.data[a].imgs.length>=1?!0:!1,this.data[a].hasImg&&(this.data[a].imgs.length>1?this.data[a].gallery=this.data[a].imgs:this.data[a].screenshot=this.data[a].imgs),this.data[a].hasVideo=void 0!==this.data[a].videos&&this.data[a].videos.length>=1?!0:!1,void 0===c[this.data[a].idtype]?(this.data[a].hasId=!0,c[this.data[a].idtype]=!0):this.data[a].hasId=!1,d="current"===this.data[a].project_type?"current":"past",b[d]=b[d]+Mustache.render(this.template,this.data[a]),$("#progressbar-container #progress").width((a+1)/this.num_projects*100+"%"));this.rendered.past=b.past,this.rendered.current=b.current,this.render()}},setup_filter_events:function(){this.filter_events_ready||(this.filter_events_ready=!0,$("#searchbox #searchitems .filter").on("click",function(a){a.stopPropagation();var b=[];_.each($("#searchbox #searchitems .filter"),function(a){$(a).prop("checked")===!0&&b.push(a.value)}),b.length>0?($("#intro").hide(),$("#intro_text").hide(),$("#current").hide(),$("#past").hide(),$("#current_projects").html(""),$("#past_projects").html("")):($("#intro, #current").show(),$("#current, #past").show()),c.filter(b),c.process(),c.render()}))},filter:function(a){var b,c=[];for(console.log("Filtering for: ",a),b=0;b<this.num_projects;b+=1)a.length>0?(c=void 0!==this.data[b].technology&&this.data[b].technology?_.intersection(this.data[b].technology,a):[],this.data[b].visibility=c.length||0):this.data[b].visibility=1},render:function(){this.el_current.html(this.rendered.current),this.el_past.html(this.rendered.past),this.trigger("foundation"),$("#num_projects").text(this.project_filter_count+" Projects"),$("#progressbar-container #progress").width("100%").css("background-color","#FFFFFF")},render_search:function(){var a,b=0;this.search.items=_.map(this.search.items,function(a){return b+=1,{item:a,index:b}}),a={items:this.search.items},$("#searchbox #searchitems").html(Mustache.render(this.search.tpl,a))}}),c=new a,c.on("loaded:search",function(){void 0!==this.search.tpl&&void 0!==this.search.items&&(this.render_search(),this.setup_filter_events())}),c.on("loaded:json",function(){this.process();var a=$("body").scrollTop();state_set("scrollposition",a),$(".icon-loading").hide()}),c.on("loaded:template",function(){this.process()}),c.on("foundation",function(){this.foundation_loaded||(this.foundation_loaded=!0,$(document).foundation())}),c.init(),$.ajax({type:"GET",url:"./last-update.php"}).done(function(a){a?$("#modification-date").text(" "+a):$("#last-update").hide()}),$("#intro #contact_link").click(function(a){a.preventDefault(),$("html, body").animate({scrollTop:$("#footer").offset().top},400),$("#footer #contact div").css("background-color","#FFFBF0")}),$("#projects").on("click","img",function(){var a=$("body").scrollTop();state_set("scrollposition",a)}),b=state_get("scrollposition"),b&&($("html, body").animate({scrollTop:b},500),b=null,state_remove("scrollposition"))});